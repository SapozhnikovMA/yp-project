## Прогноз оттока клиентов из банка  
![image](https://icdn.lenta.ru/images/2020/01/31/09/20200131092047059/original_d519e0dab2929a9bae8f82289e0da451.png)

## Стек технологий: pandas, numpy, matplotlib, sklearn (LogisticRegression, DecisionTreeClassifier, RandomForestClassifier, GradientBoostingClassifier, RandomizedSearchCV, OrdinalEncoder, f1_score)

## Описание данных и план работы:
- Построить модель с предельно большим значением F1-меры;
- EDA, чистка данных и поиск аномалий;
- Исследование задачи (улучшение метрик);
- Проверка моделей;

### Признаки
- RowNumber — индекс строки в данных  
- CustomerId — уникальный идентификатор клиента  
- Surname — фамилия  
- CreditScore — кредитный рейтинг  
- Geography — страна проживания  
- Gender — пол  
- Age — возраст  
- Tenure — сколько лет человек является клиентом банка  
- Balance — баланс на счёте  
- NumOfProducts — количество продуктов банка, используемых клиентом  
- HasCrCard — наличие кредитной карты  
- IsActiveMember — активность клиента  
- EstimatedSalary — предполагаемая зарплата  
### Целевой признак
- Exited — факт ухода клиента

#### Результат константной модели: 0.79625
Перед нами несбалансированная выборка, распеределение 0 и 1 - 80:20 - как закон Парето;
##### Варианты решения проблемы:
- Поискать еще данные, запросить у банка больше случаев с уходом клиентов;
- Синтетически увеличить редкий класс;
- Синтетически уменьшить частый класс;
- Использовать другие метрики вместо accuracy для детальной фиксации;
- Использовать гиперпараметр class_weigth = 'balanced';
- Использовать матрицу ошибок для визуального контроля.

## Лучшая модель RandomForestClassifier (bootstrap=True, class_weight='balanced', criterion='gini', max_depth=9, min_samples_leaf=4, n_estimators=70, random_state=42)
![img](https://i.ibb.co/fxBYD97/1.png)   
![img](https://i.ibb.co/3Wcnz87/image.png)

### Вывод
- Использование данной модели очень разнооборазное, мы имеем интервал порогов с высокими метриками f1 и ROC-AUC, они могут сделать модель строгой к отбору класса - 1, либо наоборот увеличивать предсказания класса 1 жертвую точностью, но не сильно, как это было в логистической регрессии;
- Максимальное значение f1 достигнуто при пороге 0.5-0.54;
- А ROC_AUC - 0.79 говорить нам, что соотношение класса TPR больше FPR при пороге 0.42 и значении Полноты - 0.773. Данное значение достигнуто при f1 - 0.61.

### Test
RandomForestClassifier (class_weight='balanced')  
`F1 = 0.62 | Точность = 0.557, Полнота = 0.705 | ROC-AUC = 0.86 | Accuracy = 0.83
[[1365  228]
 [ 120  287]]`
 
RandomForestClassifier (downsampled=0.5)  
`F1 = 0.61 | Точность = 0.644, Полнота = 0.582 | ROC-AUC = 0.86 | Accuracy = 0.85
[[1462  131]
 [ 170  237]]`

### Общий вывод
- Модели не помогут удержать клиентов, но помогут руководству банка принять правильное решение;
- С помощью графиков и пороговых значений мы можем регулировать строгость модели, если мы боимся ухода клиентов, либо скорость ухода повышается - мы понижаем порог, увеличивая работу сотрудников банка (обзвон клиентов, разработка новых продуктов для удержания, сокращение комиссий по брокерскому обслуживанию, повышение ставок по вкладам), т.к. потенциальных клиентов с классом 1 стало больше (увеличились TP and FP). Если же ситуация выравнивается, либо нужно сократить ресурсы - мы повышаем порог - увеличивая точность модели и уменьшая и TP, и FP.
